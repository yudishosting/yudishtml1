<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Playlist musik favorit dengan pengalaman premium">
  <title>Playlist Musik Favorit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700;800&display=swap');

    /* Reset dan Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1e1e4a 0%, #2d2d7a 100%);
      min-height: 100vh;
      color: #ffffff;
      overflow-x: hidden;
      position: relative;
    }

    /* Glassmorphism Effect */
    .glass-effect {
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      border-radius: 16px;
    }

    /* Card Styles */
    .card {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .card:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
    }

    /* Animasi */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Lirik Styles */
    /* Menghapus border, background, dan padding dari setiap baris lirik */
    .lyric-line {
      padding: 0; /* Menghilangkan padding */
      margin: 12px 0; /* Mengatur jarak antar baris */
      border-radius: 0; /* Menghilangkan radius */
      transition: all 0.3s ease;
      opacity: 0.7;
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .lyric-line.current {
      color: #facc15;
      font-weight: 500;
      opacity: 1;
      background: none; /* Menghilangkan latar belakang */
      border-left: 3px solid #facc15; /* Border kiri tetap dipertahankan sebagai penanda */
      padding-left: 16px; /* Menambahkan padding agar teks tidak terlalu dekat dengan border */
      transform: translateX(4px);
    }

    .lyric-line.passed {
      opacity: 0.4;
      color: rgba(255, 255, 255, 0.5);
    }

    .lyric-line.upcoming {
      opacity: 0.8;
      color: rgba(255, 255, 255, 0.9);
    }

    /* Control Buttons */
    .control-btn {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .control-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.05);
    }

    /* Now Playing Text */
    .now-playing-text {
      background: linear-gradient(90deg, #facc15, #fef08a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 600;
    }

    /* Grid Responsif */
    .grid-responsive {
      display: grid;
      gap: 1.5rem;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    /* Empty State */
    .empty-state {
      background: none; /* Menghilangkan background */
      border: none; /* Menghilangkan border */
      border-radius: 12px;
      padding: 2.5rem;
      text-align: center;
    }

    /* Partikel Animasi */
    #particleCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    /* Loading Animation */
    .loading {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Progress Bar */
    .progress-container {
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #facc15, #fef08a);
      width: 0;
      transition: width 0.1s linear;
    }

    /* Volume Slider */
    .volume-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .volume-slider {
      -webkit-appearance: none;
      width: 100px;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      outline: none;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      background: #facc15;
      border-radius: 50%;
      cursor: pointer;
    }

    /* Tampilan Font Awal Lirik */
    .initial-message {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(90deg, #facc15, #fef08a);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1.2;
        font-family: 'Playfair Display', serif;
    }

    /* Responsive Adjustments */
    @media (min-width: 640px) {
      .grid-responsive {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .grid-responsive {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 640px) {
      .container {
        padding: 1rem;
      }
      .initial-message {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <canvas id="particleCanvas"></canvas>

  <div class="absolute text-xl text-yellow-300/10 animate-[float_8s_ease-in-out_infinite]" style="top: 10%; left: 5%;">
    <i class="fas fa-music"></i>
  </div>
  <div class="absolute text-xl text-yellow-300/10 animate-[float_8s_ease-in-out_infinite_-4s]" style="top: 25%; right: 8%;">
    <i class="fas fa-musical-note"></i>
  </div>
  <div class="absolute text-xl text-yellow-300/10 animate-[float_8s_ease-in-out_infinite_-2s]" style="bottom: 15%; left: 10%;">
    <i class="fas fa-compact-disc"></i>
  </div>

  <div id="mainContent" class="container max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="glass-effect rounded-2xl p-6 sm:p-8 lg:p-10 relative z-10">
      <div class="flex justify-between items-center mb-10">
        <div>
          <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-3 font-['Playfair_Display']">
            <i class="fas fa-headphones-alt mr-2 text-yellow-400"></i>
            Playlist Musik Favorit
          </h1>
          <p class="text-gray-300 text-base sm:text-lg">Nikmati koleksi musik pilihan dengan pengalaman premium</p>
        </div>
      </div>

      <button id="backButton" class="hidden mb-6 px-5 py-2 bg-yellow-400 text-gray-900 rounded-lg hover:bg-yellow-300 transition-all duration-300 font-medium text-sm">
        <i class="fas fa-arrow-left mr-2"></i>
        Kembali ke Daftar Artis
      </button>

      <div id="artistList" class="grid-responsive"></div>

      <div id="playlist" class="hidden space-y-4"></div>

      <audio id="audioPlayer" class="hidden"></audio>

      <div id="musicControls" class="hidden mt-8">
        <div class="glass-effect rounded-2xl p-6">
          <div id="nowPlaying" class="text-lg font-medium now-playing-text mb-4"></div>
          
          <div class="progress-container mb-4" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
          </div>
          
          <div class="flex justify-between text-sm text-gray-300 mb-4">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
          </div>

          <div class="flex items-center justify-center space-x-4">
            <button onclick="playPreviousSong()" class="control-btn w-10 h-10 text-white flex items-center justify-center">
              <i class="fas fa-step-backward text-base"></i>
            </button>
            
            <button id="playPauseBtn" onclick="togglePlayPause()" class="control-btn w-14 h-14 text-white flex items-center justify-center text-lg">
              <i id="playPauseIcon" class="fas fa-play"></i>
            </button>
            
            <button onclick="playNextSongManual()" class="control-btn w-10 h-10 text-white flex items-center justify-center">
              <i class="fas fa-step-forward text-base"></i>
            </button>

            <div class="volume-container">
              <i class="fas fa-volume-up text-gray-300"></i>
              <input type="range" min="0" max="1" step="0.01" value="1" class="volume-slider" id="volumeSlider">
            </div>
          </div>
        </div>
      </div>

      <div id="lyrics" class="mt-8 p-6 glass-effect rounded-2xl text-white text-base max-h-96 overflow-y-auto">
        <div class="empty-state">
          <h3 class="initial-message font-['Playfair_Display']">
            <i class="fas fa-headphones-alt text-yellow-400 mr-2"></i>
            Pilih Artis dan Lagu
          </h3>
          <p class="text-gray-400 text-sm mt-2">untuk menampilkan lirik</p>
        </div>
      </div>

      <footer class="mt-12 pt-6 border-t border-gray-700">
        <div class="flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0">
          <div class="text-gray-300 text-sm">
            <p>&copy; 2025 <span class="font-medium text-yellow-400">Yudis</span>. All rights reserved.</p>
          </div>
          
          <div class="flex items-center space-x-3">
            <p class="text-gray-300 text-sm font-medium">Contact Me:</p>
            
            <a href="https://instagram.com/yudis_299" target="_blank" 
               class="flex items-center space-x-2 bg-yellow-400 text-gray-900 px-4 py-2 rounded-lg hover:bg-yellow-300 transition-all duration-300">
              <i class="fab fa-instagram text-base"></i>
              <span class="text-sm">@yudis_299</span>
            </a>
            
            <a href="https://wa.me/6285124039070" target="_blank" 
               class="flex items-center space-x-2 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all duration-300">
              <i class="fab fa-whatsapp text-base"></i>
              <span class="text-sm">WhatsApp</span>
            </a>
          </div>
        </div>
      </footer>
    </div>
  </div>

  <script>
    // Data Playlist (Disimpan di localStorage)
    let playlist = JSON.parse(localStorage.getItem('playlist')) || [
      {
        artist: "Nina",
        title: "Feast",
        mp3: "music/nina/feast.mp3",
        lyric: "lyrics/nina/feast.js",
        artistPhoto: "https://files.catbox.moe/u5b8mp.jpeg"
      },
      {
        artist: "Nina",
        title: "Tarot",
        mp3: "music/nina/tarot.mp3",
        lyric: "lyrics/nina/tarot.js",
        artistPhoto: "https://files.catbox.moe/u5b8mp.jpeg"
      },
      {
        artist: "Nina",
        title: "o,Tuan",
        mp3: "music/nina/otuan.mp3",
        lyric: "lyrics/nina/otuan.js",
        artistPhoto: "https://files.catbox.moe/u5b8mp.jpeg"
      },
      {
        artist: "Hindia",
        title: "Evaluasi",
        mp3: "music/hindia/evaluasi.mp3",
        lyric: "lyrics/hindia/evaluasi.js",
        artistPhoto: "https://files.catbox.moe/ln8c0r.jpg"
      },
      {
        artist: "Hindia",
        title: "Cincin",
        mp3: "music/hindia/cincin.mp3",
        lyric: "lyrics/hindia/cincin.js",
        artistPhoto: "https://files.catbox.moe/ln8c0r.jpg"
      },
      {
        artist: "Hindia",
        title: "Kita Kesana",
        mp3: "music/hindia/kitakesana.mp3",
        lyric: "lyrics/hindia/kitakesana.js",
        artistPhoto: "https://files.catbox.moe/ln8c0r.jpg"
      },
      {
        artist: "Hindia",
        title: "Everything U Are",
        mp3: "music/hindia/everything.mp3",
        lyric: "lyrics/hindia/everything.js",
        artistPhoto: "https://files.catbox.moe/ln8c0r.jpg"
      },
      {
        artist: "Nadhif Basalamah",
        title: "Bergema Sampai Selamanya",
        mp3: "music/nadifbasalamah/bergema.mp3",
        lyric: "lyrics/nadifbasalamah/bergema.js",
        artistPhoto: "https://files.catbox.moe/951vb9.jpeg"
      },
      {
        artist: "Nadhif Basalamah",
        title: "Penjaga Hati",
        mp3: "music/nadifbasalamah/penjagahati.mp3",
        lyric: "lyrics/nadifbasalamah/penjagahati.js",
        artistPhoto: "https://files.catbox.moe/951vb9.jpeg"
      }
    ];

    // DOM Elements
    const artistList = document.getElementById('artistList');
    const playlistContainer = document.getElementById('playlist');
    const audioPlayer = document.getElementById('audioPlayer');
    const lyricsContainer = document.getElementById('lyrics');
    const backButton = document.getElementById('backButton');
    const nowPlaying = document.getElementById('nowPlaying');
    const musicControls = document.getElementById('musicControls');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const playPauseIcon = document.getElementById('playPauseIcon');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const volumeSlider = document.getElementById('volumeSlider');

    // State
    let currentLyrics = [];
    let currentLineIndex = -1;
    let currentPlaylist = [];
    let currentSongIndex = -1;
    let isPlaying = false;

    // Format Waktu
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
    }

    // Partikel Animasi
    function initParticles() {
      const canvas = document.getElementById('particleCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const particles = [];
      const particleCount = 50;

      for (let i = 0; i < particleCount; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          radius: Math.random() * 2 + 1,
          speed: Math.random() * 0.5 + 0.2
        });
      }

      function animateParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
          ctx.fillStyle = 'rgba(250, 204, 21, 0.2)';
          ctx.fill();
          p.y -= p.speed;
          if (p.y < 0) p.y = canvas.height;
        });
        requestAnimationFrame(animateParticles);
      }

      animateParticles();
      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      });
    }

    // Load Daftar Artis
    function getArtists() {
      const artistsData = {};
      playlist.forEach(song => {
        if (!artistsData[song.artist]) {
          artistsData[song.artist] = {
            name: song.artist,
            songCount: 0,
            photo: song.artistPhoto
          };
        }
        artistsData[song.artist].songCount++;
      });
      return Object.values(artistsData);
    }

    function loadArtists() {
      artistList.innerHTML = '';
      const artists = getArtists();
      artists.forEach((artistData, index) => {
        const artistElement = document.createElement('div');
        artistElement.classList.add('card', 'p-6', 'fade-in');
        artistElement.style.animationDelay = `${index * 0.1}s`;
        artistElement.innerHTML = `
          ${artistData.photo ? `
            <div class="mb-4 flex justify-center">
              <img src="${artistData.photo}" alt="${artistData.name}" 
                   class="w-24 h-24 rounded-full object-cover border-2 border-yellow-400/30 shadow-lg">
            </div>
          ` : `
            <div class="mb-4 flex justify-center">
              <div class="w-24 h-24 rounded-full bg-yellow-400/10 flex items-center justify-center">
                <i class="fas fa-user-music text-2xl text-yellow-400"></i>
              </div>
            </div>
          `}
          <h3 class="text-xl font-medium text-white text-center">${artistData.name}</h3>
          <p class="text-gray-300 text-sm text-center">${artistData.songCount} lagu</p>
        `;
        artistElement.addEventListener('click', () => {
          showArtistSongs(artistData.name);
        });
        artistList.appendChild(artistElement);
      });
    }

    // Tampilkan Lagu per Artis
    function showArtistSongs(artist) {
      artistList.classList.add('hidden');
      playlistContainer.classList.remove('hidden');
      backButton.classList.remove('hidden');
      playlistContainer.innerHTML = '';

      currentPlaylist = playlist.filter(song => song.artist === artist);
      currentSongIndex = -1;

      // Artist Header
      const artistHeader = document.createElement('div');
      artistHeader.classList.add('text-center', 'mb-8', 'fade-in');
      const artistPhoto = currentPlaylist[0]?.artistPhoto;
      artistHeader.innerHTML = `
        <div class="flex flex-col items-center space-y-4">
          ${artistPhoto ? `
            <img src="${artistPhoto}" alt="${artist}" 
                 class="w-32 h-32 rounded-full object-cover border-2 border-yellow-400/30 shadow-xl">
          ` : `
            <div class="w-32 h-32 rounded-full bg-yellow-400/10 flex items-center justify-center">
              <i class="fas fa-user-music text-3xl text-yellow-400"></i>
            </div>
          `}
          <div>
            <h2 class="text-2xl sm:text-3xl font-semibold text-white font-['Playfair_Display']">${artist}</h2>
            <p class="text-gray-300 text-base">${currentPlaylist.length} lagu tersedia</p>
          </div>
        </div>
      `;
      playlistContainer.appendChild(artistHeader);

      // Songs List
      currentPlaylist.forEach((song, index) => {
        const songElement = document.createElement('div');
        songElement.classList.add('card', 'p-4', 'fade-in', 'flex', 'items-center', 'space-x-4', 'cursor-pointer');
        songElement.style.animationDelay = `${index * 0.1}s`;
        songElement.dataset.songIndex = index;
        songElement.innerHTML = `
          <div class="text-yellow-400 text-xl">
            <i class="fas fa-play-circle"></i>
          </div>
          <div class="flex-1">
            <h4 class="text-base font-medium text-white">${song.title}</h4>
            <p class="text-gray-300 text-sm">${song.artist}</p>
          </div>
          <div class="text-gray-400 text-sm">
            ${index + 1}/${currentPlaylist.length}
          </div>
        `;
        songElement.addEventListener('click', () => {
          playSong(song, index);
        });
        playlistContainer.appendChild(songElement);
      });
    }

    // Mainkan Lagu
    function playSong(song, index) {
      currentSongIndex = index;

      document.querySelectorAll('#playlist > div.card').forEach(el => {
        el.classList.remove('bg-yellow-400/10');
      });

      const currentSongElement = document.querySelector(`[data-song-index="${currentSongIndex}"]`);
      if (currentSongElement) {
        currentSongElement.classList.add('bg-yellow-400/10');
      }

      audioPlayer.src = song.mp3;
      audioPlayer.play().catch(error => {
        console.error('Gagal memutar audio:', error);
        nowPlaying.innerHTML = `
          <i class="fas fa-exclamation-triangle mr-2 text-red-400"></i>
          Gagal memutar lagu.
        `;
      });

      isPlaying = true;
      updatePlayPauseButton();
      musicControls.classList.remove('hidden');

      nowPlaying.innerHTML = `
        <i class="fas fa-music mr-2"></i>
        Sedang diputar: <span class="font-medium">${song.artist} - ${song.title}</span>
        <br><span class="text-gray-300 text-sm">(${currentSongIndex + 1}/${currentPlaylist.length})</span>
      `;

      loadLyrics(song.lyric);
    }

    // Toggle Play/Pause
    function togglePlayPause() {
      if (isPlaying) {
        audioPlayer.pause();
        isPlaying = false;
      } else {
        audioPlayer.play();
        isPlaying = true;
      }
      updatePlayPauseButton();
    }

    function updatePlayPauseButton() {
      playPauseIcon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
    }

    // Load Lirik
    function loadLyrics(lyricPath) {
      lyricsContainer.innerHTML = `
        <div class="text-center py-8">
          <i class="fas fa-spinner loading text-xl text-yellow-400 mb-3"></i>
          <p class="text-gray-300">Memuat lirik...</p>
        </div>
      `;

      const oldScript = document.getElementById('lyricScript');
      if (oldScript) oldScript.remove();

      const script = document.createElement('script');
      script.id = 'lyricScript';
      script.src = lyricPath;
      script.onload = () => {
        if (window.lyrics && Array.isArray(window.lyrics)) {
          currentLyrics = window.lyrics.filter(line => 
            typeof line === 'object' && 
            typeof line.time === 'number' && 
            typeof line.text === 'string'
          );

          if (currentLyrics.length > 0) {
            displayLyrics();
            startAutoScroll();
          } else {
            lyricsContainer.innerHTML = `
              <div class="empty-state">
                <i class="fas fa-exclamation-triangle text-xl text-orange-400 mb-3"></i>
                <p class="text-gray-300">Format lirik tidak valid.</p>
              </div>
            `;
          }
        } else {
          lyricsContainer.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-times-circle text-xl text-red-400 mb-3"></i>
              <p class="text-gray-300">Lirik tidak valid.</p>
            </div>
          `;
        }
      };
      script.onerror = () => {
        lyricsContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-exclamation-circle text-xl text-red-400 mb-3"></i>
            <p class="text-gray-300">Gagal memuat lirik.</p>
          </div>
        `;
      };
      document.body.appendChild(script);
    }

    // Tampilkan Lirik
    function displayLyrics() {
      lyricsContainer.innerHTML = '';
      if (!currentLyrics || !Array.isArray(currentLyrics)) {
        lyricsContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-music text-xl text-gray-400 mb-3"></i>
            <p class="text-gray-300">Tidak ada lirik untuk ditampilkan.</p>
          </div>
        `;
        return;
      }

      currentLyrics.forEach((line, index) => {
        const lineElement = document.createElement('div');
        lineElement.classList.add('lyric-line');
        lineElement.textContent = line.text;
        lineElement.dataset.index = index;
        lineElement.dataset.time = line.time;
        lyricsContainer.appendChild(lineElement);
      });

      currentLineIndex = -1;
      updateLyricDisplay();
    }

    // Auto Scroll Lirik
    function startAutoScroll() {
      currentLineIndex = -1;
      updateLyricDisplay();

      audioPlayer.removeEventListener('timeupdate', handleTimeUpdate);
      audioPlayer.removeEventListener('ended', handleEnded);
      audioPlayer.removeEventListener('pause', handlePause);
      audioPlayer.removeEventListener('play', handlePlay);
      audioPlayer.removeEventListener('loadedmetadata', updateDuration);

      audioPlayer.addEventListener('timeupdate', handleTimeUpdate);
      audioPlayer.addEventListener('ended', handleEnded);
      audioPlayer.addEventListener('pause', handlePause);
      audioPlayer.addEventListener('play', handlePlay);
      audioPlayer.addEventListener('loadedmetadata', updateDuration);
    }

    function handleTimeUpdate() {
      const currentTime = audioPlayer.currentTime;
      let newLineIndex = -1;

      for (let i = currentLyrics.length - 1; i >= 0; i--) {
        if (currentTime >= currentLyrics[i].time) {
          newLineIndex = i;
          break;
        }
      }

      if (newLineIndex !== currentLineIndex) {
        currentLineIndex = newLineIndex;
        updateLyricDisplay();
        if (newLineIndex >= 0) {
          scrollToCurrentLine();
        }
      }

      // Update Progress Bar
      const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
      progressBar.style.width = `${progress}%`;
      currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
    }

    function updateDuration() {
      durationEl.textContent = formatTime(audioPlayer.duration);
    }

    function handleEnded() {
      isPlaying = false;
      updatePlayPauseButton();
      currentLineIndex = -1;
      updateLyricDisplay();
      lyricsContainer.scrollTop = 0;
      playNextSong();
    }

    function handlePause() {
      isPlaying = false;
      updatePlayPauseButton();
    }

    function handlePlay() {
      isPlaying = true;
      updatePlayPauseButton();
    }

    // Navigasi Lagu
    function playNextSongManual() {
      if (currentPlaylist.length > 0 && currentSongIndex < currentPlaylist.length - 1) {
        const nextIndex = currentSongIndex + 1;
        const nextSong = currentPlaylist[nextIndex];
        playSong(nextSong, nextIndex);
      } else if (currentPlaylist.length > 0) {
        const firstSong = currentPlaylist[0];
        playSong(firstSong, 0);
      }
    }

    function playPreviousSong() {
      if (currentPlaylist.length > 0 && currentSongIndex > 0) {
        const prevIndex = currentSongIndex - 1;
        const prevSong = currentPlaylist[prevIndex];
        playSong(prevSong, prevIndex);
      } else if (currentPlaylist.length > 0) {
        const lastIndex = currentPlaylist.length - 1;
        const lastSong = currentPlaylist[lastIndex];
        playSong(lastSong, lastIndex);
      }
    }

    function playNextSong() {
      if (currentPlaylist.length > 0 && currentSongIndex < currentPlaylist.length - 1) {
        const nextIndex = currentSongIndex + 1;
        const nextSong = currentPlaylist[nextIndex];
        setTimeout(() => {
          playSong(nextSong, nextIndex);
        }, 1000);
      } else if (currentPlaylist.length > 0) {
        nowPlaying.innerHTML = `
          <i class="fas fa-check-circle mr-2 text-green-400"></i>
          Playlist selesai - Semua lagu telah diputar
        `;
        musicControls.classList.add('hidden');
        currentSongIndex = -1;
        document.querySelectorAll('#playlist > div.card').forEach(el => {
          el.classList.remove('bg-yellow-400/10');
        });
      }
    }

    // Update Tampilan Lirik
    function updateLyricDisplay() {
      const lyricLines = document.querySelectorAll('.lyric-line');

      lyricLines.forEach((line, index) => {
        line.classList.remove('current', 'passed', 'upcoming');

        if (currentLineIndex === -1) {
          line.classList.add('upcoming');
        } else if (index < currentLineIndex) {
          line.classList.add('passed');
        } else if (index === currentLineIndex) {
          line.classList.add('current');
        } else {
          line.classList.add('upcoming');
        }
      });
    }

    // Scroll ke Baris Lirik Aktif
    function scrollToCurrentLine() {
      const currentLine = document.querySelector(`[data-index="${currentLineIndex}"]`);
      if (currentLine) {
        currentLine.scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });
      }
    }

    // Event Listeners
    backButton.addEventListener('click', () => {
      artistList.classList.remove('hidden');
      playlistContainer.classList.add('hidden');
      backButton.classList.add('hidden');
      musicControls.classList.add('hidden');
      audioPlayer.pause();
      isPlaying = false;
      updatePlayPauseButton();
      nowPlaying.textContent = '';
      lyricsContainer.innerHTML = `
        <div class="empty-state">
          <h3 class="initial-message font-['Playfair_Display']">
            <i class="fas fa-headphones-alt text-yellow-400 mr-2"></i>
            Pilih Artis dan Lagu
          </h3>
          <p class="text-gray-400 text-sm mt-2">untuk menampilkan lirik</p>
        </div>
      `;
      currentLyrics = [];
      currentLineIndex = -1;
      currentPlaylist = [];
      currentSongIndex = -1;

      // Clean up listeners
      audioPlayer.removeEventListener('timeupdate', handleTimeUpdate);
      audioPlayer.removeEventListener('ended', handleEnded);
      audioPlayer.removeEventListener('pause', handlePause);
      audioPlayer.removeEventListener('play', handlePlay);
      audioPlayer.removeEventListener('loadedmetadata', updateDuration);
    });

    // Progress Bar Interaction
    progressContainer.addEventListener('click', (e) => {
      const rect = progressContainer.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const width = rect.width;
      const percentage = clickX / width;
      audioPlayer.currentTime = percentage * audioPlayer.duration;
    });

    // Volume Control
    volumeSlider.addEventListener('input', () => {
      audioPlayer.volume = volumeSlider.value;
    });

    // Inisialisasi
    initParticles();
    loadArtists();
  </script>
</body>
</html>
