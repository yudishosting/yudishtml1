<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Playlist Lagu Favorit</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; padding: 20px; }
    h1 { text-align: center; }
    .artist, .song {
      background: #fff; margin: 10px auto; padding: 10px;
      max-width: 600px; border: 1px solid #ddd; cursor: pointer;
    }
    .artist:hover, .song:hover { background: #eee; }
    .song-list { margin-left: 20px; }
    audio { display: block; margin: 20px auto; width: 100%; max-width: 600px; }
    pre { background: #fff; padding: 15px; border: 1px solid #ccc;
          white-space: pre-wrap; max-width: 600px; margin: 10px auto; }
  </style>
</head>
<body>
  <h1>ðŸŽ¶ Playlist Lagu</h1>
  <div id="playlist">Memuat daftar artis...</div>
  <audio id="player" controls autoplay></audio>
  <pre id="lyrics">Klik lagu untuk memutar dan menampilkan lirik.</pre>

  <script>
    const musicPath = "music/";
    const lyricsPath = "lyrics/";
    const playlistDiv = document.getElementById("playlist");
    const player = document.getElementById("player");
    const lyricsBox = document.getElementById("lyrics");

    async function fetchFolderList(path) {
      try {
        const res = await fetch(path);
        const text = await res.text();
        const folderMatches = [...text.matchAll(/href="([^?"]+)\/"/g)];
        return folderMatches.map(m => m[1]).filter(name => name !== '..');
      } catch {
        return [];
      }
    }

    async function fetchFileList(path, ext) {
      try {
        const res = await fetch(path);
        const text = await res.text();
        const fileMatches = [...text.matchAll(new RegExp(`href="([^?"]+\\.${ext})"`, 'g'))];
        return fileMatches.map(m => m[1]);
      } catch {
        return [];
      }
    }

    async function loadPlaylist() {
      const artists = await fetchFolderList(musicPath);
      if (artists.length === 0) {
        playlistDiv.textContent = "Tidak ada artis ditemukan.";
        return;
      }

      playlistDiv.innerHTML = '';
      for (const artist of artists) {
        const artistDiv = document.createElement("div");
        artistDiv.className = "artist";
        artistDiv.textContent = `ðŸŽ¤ ${artist}`;
        const songList = document.createElement("div");
        songList.className = "song-list";
        artistDiv.onclick = async () => {
          songList.innerHTML = "Memuat lagu...";
          const songs = await fetchFileList(`${musicPath}${artist}/`, 'mp3');
          if (songs.length === 0) {
            songList.innerHTML = "Tidak ada lagu.";
            return;
          }
          songList.innerHTML = '';
          songs.forEach(file => {
            const name = file.replace(".mp3", "");
            const songDiv = document.createElement("div");
            songDiv.className = "song";
            songDiv.textContent = name;
            songDiv.onclick = () => playSong(artist, name);
            songList.appendChild(songDiv);
          });
        };
        playlistDiv.appendChild(artistDiv);
        playlistDiv.appendChild(songList);
      }
    }

    function playSong(artist, song) {
      const audioURL = `${musicPath}${artist}/${song}.mp3`;
      const lyricURL = `${lyricsPath}${artist}/${song}.js`;

      player.src = audioURL;
      player.play();
      lyricsBox.textContent = "Memuat lirik...";

      const oldScript = document.getElementById("lyricScript");
      if (oldScript) oldScript.remove();

      const script = document.createElement("script");
      script.id = "lyricScript";
      script.src = lyricURL;
      script.onload = () => {
        if (typeof songData !== "undefined" && songData.lyrics) {
          lyricsBox.textContent = songData.lyrics;
        } else {
          lyricsBox.textContent = "Lirik tidak ditemukan.";
        }
      };
      script.onerror = () => {
        lyricsBox.textContent = "Lirik gagal dimuat.";
      };
      document.body.appendChild(script);
    }

    loadPlaylist();
  </script>
</body>
</html>