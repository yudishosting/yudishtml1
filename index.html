<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Playlist Musik Favorit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    ::-webkit-scrollbar-thumb {
      background: #6b7280;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #4b5563;
    }
    .lyric-line {
      padding: 8px 0;
      transition: all 0.3s ease-in-out;
      opacity: 0.6;
    }
    .lyric-line.current {
      color: #4f46e5;
      font-weight: bold;
      transform: scale(1.05);
      opacity: 1;
    }
    .lyric-line.passed {
      opacity: 0.4;
    }
    .lyric-line.upcoming {
      opacity: 0.7;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="container max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-8">
    <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">Playlist Musik Favorit</h1>
    <button id="backButton" class="hidden mb-6 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-300">Kembali ke Daftar Artis</button>
    <div id="artistList" class="space-y-4"></div>
    <div id="playlist" class="hidden space-y-4"></div>
    <div id="player" class="mt-8 text-center">
      <audio id="audioPlayer" controls class="w-full"></audio>
      <div id="nowPlaying" class="text-gray-600 text-sm mt-2"></div>
    </div>
    <div id="lyrics" class="mt-8 p-6 bg-gray-50 rounded-lg text-gray-700 font-mono text-sm leading-relaxed max-h-80 overflow-y-auto"></div>
  </div>

  <script>
    const playlist = [
      {
        artist: "Nina",
        title: "Feast",
        mp3: "music/nina/feast.mp3",
        lyric: "lyrics/nina/feast.js"
      },
      {
        artist: "Yura",
        title: "Yura",
        mp3: "music/yura/yura.mp3",
        lyric: "lyrics/yura/yura.js"
      },
      {
        artist: "Nina",
        title: "o,Tuan",
        mp3: "music/nina/otuan.mp3",
        lyric: "lyrics/nina/otuan.js"
      }
    ];

    const artistList = document.getElementById('artistList');
    const playlistContainer = document.getElementById('playlist');
    const audioPlayer = document.getElementById('audioPlayer');
    const lyricsContainer = document.getElementById('lyrics');
    const backButton = document.getElementById('backButton');
    const nowPlaying = document.getElementById('nowPlaying');
    let currentLyrics = [];
    let currentLineIndex = 0;
    let scrollInterval = null;

    function getArtists() {
      return [...new Set(playlist.map(song => song.artist))];
    }

    function loadArtists() {
      artistList.innerHTML = '';
      const artists = getArtists();
      artists.forEach(artist => {
        const artistElement = document.createElement('div');
        artistElement.classList.add('p-4', 'bg-indigo-50', 'rounded-lg', 'cursor-pointer', 'hover:bg-indigo-100', 'transition', 'duration-300', 'fade-in');
        artistElement.textContent = artist;
        artistElement.addEventListener('click', () => showArtistSongs(artist));
        artistList.appendChild(artistElement);
      });
    }

    function showArtistSongs(artist) {
      artistList.classList.add('hidden');
      playlistContainer.classList.remove('hidden');
      backButton.classList.remove('hidden');
      playlistContainer.innerHTML = '';

      const songs = playlist.filter(song => song.artist === artist);
      songs.forEach(song => {
        const songElement = document.createElement('div');
        songElement.classList.add('p-4', 'bg-gray-50', 'rounded-lg', 'cursor-pointer', 'hover:bg-gray-100', 'transition', 'duration-300', 'fade-in');
        songElement.textContent = song.title;
        songElement.addEventListener('click', () => playSong(song));
        playlistContainer.appendChild(songElement);
      });
    }

    function playSong(song) {
      document.querySelectorAll('#playlist > div').forEach(el => {
        el.classList.toggle('bg-indigo-200', el.textContent === song.title);
        el.classList.toggle('bg-gray-50', el.textContent !== song.title);
      });

      audioPlayer.src = song.mp3;
      audioPlayer.play().catch(error => {
        console.error('Gagal memutar audio:', error);
        nowPlaying.textContent = 'Gagal memutar lagu.';
      });

      nowPlaying.textContent = `Sedang diputar: ${song.artist} - ${song.title}`;
      loadLyrics(song.lyric);
    }

    function loadLyrics(lyricPath) {
      lyricsContainer.innerHTML = 'Memuat lirik...';
      const oldScript = document.getElementById('lyricScript');
      if (oldScript) oldScript.remove();

      const script = document.createElement('script');
      script.id = 'lyricScript';
      script.src = lyricPath;
      script.onload = () => {
        if (window.lyrics && Array.isArray(window.lyrics)) {
          // Convert time-based lyrics to simple text array
          currentLyrics = window.lyrics.map(line => {
            if (typeof line === 'object' && line.text) {
              return line.text;
            }
            return typeof line === 'string' ? line : 'Lirik tidak valid';
          });
          displayLyrics();
          startAutoScroll();
        } else {
          lyricsContainer.textContent = 'Lirik tidak valid.';
          console.error('Format lirik salah di:', lyricPath, window.lyrics);
        }
      };
      script.onerror = () => {
        lyricsContainer.textContent = 'Gagal memuat lirik. Periksa path file: ' + lyricPath;
        console.error('Gagal memuat file lirik:', lyricPath);
      };
      document.body.appendChild(script);
    }

    function displayLyrics() {
      lyricsContainer.innerHTML = '';
      if (!currentLyrics || !Array.isArray(currentLyrics)) {
        lyricsContainer.textContent = 'Tidak ada lirik untuk ditampilkan.';
        return;
      }
      
      currentLyrics.forEach((text, index) => {
        const lineElement = document.createElement('div');
        lineElement.classList.add('lyric-line');
        lineElement.textContent = text;
        lineElement.dataset.index = index;
        lyricsContainer.appendChild(lineElement);
      });
      
      // Reset current line index
      currentLineIndex = 0;
      updateLyricDisplay();
    }

    function startAutoScroll() {
      // Clear any existing interval
      if (scrollInterval) {
        clearInterval(scrollInterval);
      }
      
      currentLineIndex = 0;
      
      // Calculate scroll timing based on audio duration and number of lyrics
      audioPlayer.addEventListener('loadedmetadata', () => {
        const duration = audioPlayer.duration;
        const lyricsCount = currentLyrics.length;
        
        if (duration && lyricsCount > 0) {
          // Calculate interval: distribute lyrics evenly across song duration
          const intervalTime = (duration * 1000) / lyricsCount;
          
          scrollInterval = setInterval(() => {
            if (currentLineIndex < currentLyrics.length && !audioPlayer.paused) {
              updateLyricDisplay();
              scrollToCurrentLine();
              currentLineIndex++;
            } else if (currentLineIndex >= currentLyrics.length) {
              clearInterval(scrollInterval);
            }
          }, intervalTime);
        }
      });

      // Reset scroll when song ends or is paused
      audioPlayer.addEventListener('ended', () => {
        if (scrollInterval) {
          clearInterval(scrollInterval);
        }
        currentLineIndex = 0;
        updateLyricDisplay();
      });

      audioPlayer.addEventListener('pause', () => {
        if (scrollInterval) {
          clearInterval(scrollInterval);
        }
      });

      audioPlayer.addEventListener('play', () => {
        if (!scrollInterval && currentLyrics.length > 0) {
          startAutoScroll();
        }
      });
    }

    function updateLyricDisplay() {
      const lyricLines = document.querySelectorAll('.lyric-line');
      
      lyricLines.forEach((line, index) => {
        line.classList.remove('current', 'passed', 'upcoming');
        
        if (index < currentLineIndex) {
          line.classList.add('passed');
        } else if (index === currentLineIndex) {
          line.classList.add('current');
        } else {
          line.classList.add('upcoming');
        }
      });
    }

    function scrollToCurrentLine() {
      const currentLine = document.querySelector(`[data-index="${currentLineIndex}"]`);
      if (currentLine) {
        const container = lyricsContainer;
        const lineRect = currentLine.getBoundingClientRect();
        const containerRect = container.getBoundingClientRect();
        const offset = lineRect.top - containerRect.top + container.scrollTop - container.clientHeight / 2;
        
        container.scrollTo({
          top: Math.max(0, offset),
          behavior: 'smooth'
        });
      }
    }

    backButton.addEventListener('click', () => {
      artistList.classList.remove('hidden');
      playlistContainer.classList.add('hidden');
      backButton.classList.add('hidden');
      audioPlayer.pause();
      nowPlaying.textContent = '';
      lyricsContainer.textContent = '';
      currentLyrics = [];
      currentLineIndex = 0;
      
      if (scrollInterval) {
        clearInterval(scrollInterval);
        scrollInterval = null;
      }
    });

    // Manual scroll controls with mouse wheel
    lyricsContainer.addEventListener('wheel', (e) => {
      e.preventDefault();
      const scrollAmount = e.deltaY * 2;
      lyricsContainer.scrollBy({
        top: scrollAmount,
        behavior: 'smooth'
      });
    });

    loadArtists();
  </script>
</body>
</html>